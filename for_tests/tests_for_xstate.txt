Интеграция платёжного шлюза: поддержка банковских карт (Visa, MasterCard, МИР), электронных кошельков (Apple Pay, Google Pay) и прямых банковских переводов.

Соответствие стандартам: соблюдение PCI DSS, GDPR и локальных норм ФЗ-152 «О персональных данных».

Авторизация и аутентификация: оплата доступна только для зарегистрированных пользователей с подтверждённой учётной записью.

Поддержка частичного покрытия: возможность оплаты товаров как за счёт пациента, так и по льготным или страховым программам.

Безопасность транзакций: шифрование данных в движении и покое, защита от CSRF/ XSS, многофакторная аутентификация при высоких суммах.

UI/UX: адаптивный интерфейс, подсказки по формату ввода карты, индикатор процесса оплаты, понятные сообщения об ошибках.

Логирование и отчётность: хранение полного лога транзакций, интеграция с системой отчётности (для бухгалтерии медицинского учреждения).

Обработка ошибок и возвратов: единый механизм rollback, автоматические уведомления пользователя и админа при неуспешной оплате или запросе на возврат.

Квитанции и подтверждения: мгновенная генерация PDF-квитанции и отправка на e-mail пользователя.

2. User Stories
Как пациент, я хочу выбрать удобный способ оплаты (картой, электронным кошельком), чтобы быстро и безопасно оплатить медицинские товары.

Как регистратор аптеки, я хочу видеть статус платежа в панели администратора, чтобы оперативно выдавать товар и минимизировать очереди.

Как бухгалтер клиники, я хочу получать сводные отчёты по выполненным транзакциям, чтобы автоматизировать учёт и сверку.

Как системный администратор, я хочу логировать все шаги платежного процесса, чтобы обеспечить аудит и расследование инцидентов.

Как пользователь с льготами, я хочу применять страховые компенсации или государственные субсидии при оплате, чтобы снизить свою финансовую нагрузку.

3. Acceptance Criteria
Пациент: выбор способа оплаты

При открытии страницы «Оплата» отображаются все доступные методы (карта, Apple Pay, Google Pay, перевод).

При выборе карты поля ввода маскируются (**** **** **** 1234), ввод даты и CVC проверяются на корректность.

После нажатия «Оплатить» показывается спиннер и блокируется кнопка до завершения операции.

При успешной оплате пользователь видит сообщение «Платёж успешно выполнен», получает PDF-квитанцию на экран и на e-mail.

При неуспешной оплате выводится подробная ошибка (например, «Отказ банка», «Недостаточно средств») и возможность повторить попытку.

Регистратор аптеки: статус платежа

В панели администратора около каждого заказа отображается статус: «Ожидает оплаты», «Оплачено», «Ошибка платежа».

При изменении статуса в реальном времени (websocket или поллинг не реже 5 секунд) цвет статуса меняется: серый, зелёный, красный.

При статусе «Оплачено» активируется кнопка «Выдать товар».

Бухгалтерия: отчёт по транзакциям

Раздел «Отчёты» формирует XLSX со всеми транзакциями за выбранный период (дата — от/до) с колонками: ID платежа, дата/время, метод, сумма, статус, ID заказа, пользователь.

Экспорт занимает не более 30 секунд при выборке до 10 000 записей.

При открытии отчёта в Excel форматы дат и чисел соответствуют локальным настройкам (дд.мм.гггг, разделитель тысяч).

Администратор: логирование

В системном логе фиксируются все события: инициирование платежа, отдача запроса на шлюз, ответ шлюза, успешная/неуспешная транзакция.

Логи доступны в интерфейсе админа с возможностью фильтрации по дате, статусу и ID платежа.

При критической ошибке (например, ошибка шифрования) создаётся инцидент в системе мониторинга.

Пользователь с льготами: применение компенсаций

На этапе оплаты доступна опция «Использовать страховые/государственные льготы».

После выбора опции автоматически рассчитывается сумма к оплате и показывается две строки: «Общая стоимость» и «К оплате с учётом льгот».

При подтверждении льготного расчёта появляется уведомление «Льгота применена: ваша сумма к оплате составила ХХ ₽».

В отчётах бухгалтера у таких транзакций дополнительно указывается тип компенсации и её размер.